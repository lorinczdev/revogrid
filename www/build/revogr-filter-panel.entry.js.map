{"version":3,"names":["RevoButton","props","children","h","Object","assign","class","closest","Element","prototype","matches","msMatchesSelector","webkitMatchesSelector","s","el","this","call","parentElement","parentNode","nodeType","filterStyleCss","defaultType","FILTER_LIST_CLASS","FilterPanel","filterCaptionsInternal","title","save","reset","cancel","debouncedApplyFilter","debounce","filterChange","emit","filterItems","onMouseDown","e","changes","defaultPrevented","target","isOutside","isFilterBtn","undefined","show","newEntity","type","getChanges","componentWillRender","isFilterIdSet","keys","prop","filterId","length","renderSelectOptions","isDefaultTypeRemoved","options","gIndex","filterTypes","push","map","k","value","selected","filterNames","renderExtra","index","currentFilter","filterEntities","extra","id","onInput","onUserInput","bind","onKeyDown","getFilterItemsList","_a","addNewFilter","propFilters","key","d","onClick","toggleFilterAndOr","AndOrButton","isAnd","relation","onChange","onFilterTypeChange","onReset","TrashButton","render","Host","style","display","left","x","top","y","capts","filterCaptions","disableDynamicFiltering","red","onSave","setTimeout","input","document","getElementById","focus","onAddNewFilter","currentFilterType","addNewFilterToProp","select","currentFilterId","event","toLowerCase","stopPropagation","onCancel","assertChanges","onRemoveFilter","items","findIndex","splice","Error","classList","contains","uuid"],"sources":["src/components/button/button.tsx","src/utils/closestPolifill.ts","src/plugins/filter/filter.style.scss?tag=revogr-filter-panel","src/plugins/filter/filter.pop.tsx"],"sourcesContent":["import { h } from '@stencil/core';\nimport { JSXBase, VNode } from '@stencil/core/internal';\n\ninterface Props extends Partial<JSXBase.ButtonHTMLAttributes<HTMLButtonElement>> {}\n\nexport const RevoButton = (props: Props, children: VNode[]) => {\n  return (\n    <button\n      {...props}\n      class={{\n        ...(typeof props.class === 'object' ? props.class : props.class ? { [props.class]: true } : ''),\n        ['revo-button']: true,\n      }}\n    >\n      {children}\n    </button>\n  );\n};\n","(function closest() {\n  if (!Element.prototype.matches) {\n    Element.prototype.matches =\n      ((Element.prototype as unknown) as { msMatchesSelector: (selectors: string) => boolean }).msMatchesSelector || Element.prototype.webkitMatchesSelector;\n  }\n\n  if (!Element.prototype.closest) {\n    Element.prototype.closest = function (s: string) {\n      let el: HTMLElement | Element | (Node & ParentNode) = this;\n\n      do {\n        if (Element.prototype.matches.call(el, s)) {\n          return el;\n        }\n        el = el.parentElement || el.parentNode;\n      } while (el !== null && el.nodeType === 1);\n      return null;\n    };\n  }\n})();\n","revogr-filter-panel {\n  position: absolute;\n  display: block;\n  top: 0;\n  left: 0;\n  z-index: 100;\n\n  opacity: 1;\n  transform: none;\n  background-color: #fff;\n  transform-origin: 62px 0px;\n  box-shadow: 0 5px 18px -2px rgba(black, 20%);\n  padding: 10px;\n  border-radius: 4px;\n\n  min-width: 220px;\n  text-align: left;\n\n  .filter-holder > div {\n    display: flex;\n    flex-direction: column;\n  }\n\n  label {\n    color: gray;\n    font-size: 13px;\n    font-weight: 600;\n    display: block;\n    padding: 8px 0;\n  }\n\n  select {\n    width: 100%;\n  }\n\n  input[type=\"text\"] {\n    border: 0;\n    min-height: 34px;\n    margin: 5px 0;\n    background: #f3f3f3;\n    border-radius: 5px;\n    padding: 0 10px;\n    box-sizing: border-box;\n    width: 100%;\n  }\n\n  button {\n    margin-top: 10px;\n    margin-right: 5px;\n  }\n\n\n  .filter-actions {\n    text-align: right;\n    margin-right: -5px;\n  }\n}\n\n.rgHeaderCell {\n  &:hover .rv-filter {\n    transition: opacity 267ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, transform 178ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;\n  }\n  &:hover .rv-filter,\n  .rv-filter.active {\n    opacity: 1;\n  }\n\n  .rv-filter {\n    $btn-size: 24px;\n    height: $btn-size;\n    width: $btn-size;\n    background: none;\n    border: 0;\n    opacity: 0;\n    visibility: visible;\n    cursor: pointer;\n    border-radius: 4px;\n\n    &.active {\n      color: #10224a;\n    }\n\n    .filter-img {\n      $img-size: 11px;\n      color: gray;\n      width: $img-size;\n    }\n  }\n}\n\n.select-css {\n  $gradient: \"data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E\";\n  $linearGradient: linear-gradient(to bottom, #ffffff 0%, #ffffff 100%);\n  $borderColor: #f1f1f1;\n\n  display: block;\n  font-family: sans-serif;\n  font-weight: 600;\n  color: #444;\n  line-height: 1.3;\n  padding: 0.6em 1.4em 0.5em 0.8em;\n  width: 100%;\n  max-width: 100%; /* useful when width is set to anything other than 100% */\n  box-sizing: border-box;\n  margin: 0;\n  border: 1px solid $borderColor;\n  box-shadow: transparent;\n  border-radius: 0.5em;\n  appearance: none;\n  background-color: #fff;\n  background-image: url($gradient), $linearGradient;\n  background-repeat: no-repeat, repeat;\n  /* arrow icon position (1em from the right, 50% vertical) , then gradient position*/\n  background-position: right 0.7em top 50%, 0 0;\n  /* icon size, then gradient */\n  background-size: 0.65em auto, 100%;\n\n  /* Hide arrow icon in IE browsers */\n  &::-ms-expand {\n    display: none;\n  }\n  /* Hover style */\n  &:hover {\n    border-color: rgb(197, 197, 197);\n  }\n  /* Focus style */\n  &:focus {\n    border-color: $borderColor;\n    box-shadow: 0 0 1px 3px rgba(59, 153, 252, 0.7);\n    box-shadow: 0 0 0 3px -moz-mac-focusring;\n    color: #222;\n    outline: none;\n  }\n\n  /* Set options to normal weight */\n  option {\n    font-weight: normal;\n  }\n\n  /* Disabled styles */\n  &:disabled,\n  &[aria-disabled=\"true\"] {\n    color: gray;\n    background-image: url(\"data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22graytext%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E\"),\n      linear-gradient(to bottom, #ffffff 0%, #ffffff 100%);\n  }\n\n  &:disabled:hover,\n  &[aria-disabled=\"true\"] {\n    border-color: $borderColor;\n  }\n}\n\n.multi-filter-list {\n  margin-top: 5px;\n  margin-bottom: 5px;\n\n  div {\n    white-space: nowrap;\n  }\n\n  .multi-filter-list-action {\n    display: flex;\n\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .and-or-button {\n    margin: 0 0 0 10px;\n    min-width: 58px;\n    cursor: pointer;\n  }\n  .trash-button {\n    $btn-remove-size: 22px;\n    margin: 0 0 -2px 6px;\n    cursor: pointer;\n\n    width: $btn-remove-size;\n    height: $btn-remove-size;\n    color: gray;\n    font-size: 18px;\n\n\n    .trash-img {\n      width: 1em;\n    }\n  }\n}\n\n.add-filter-divider {\n  display: block;\n  margin: 0 -10px 10px -10px;\n\n  border-bottom: 1px solid #d9d9d9;\n  height: 10px;\n  box-shadow: 0 4px 5px rgb(0 0 0 / 5%);\n}\n\n.select-input {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}","import { Component, h, Host, Listen, Prop, State, Event, EventEmitter, VNode, Method } from '@stencil/core';\nimport { FilterType } from './filter.service';\nimport { RevoGrid } from '../../interfaces';\nimport { AndOrButton, isFilterBtn, TrashButton } from './filter.button';\nimport { RevoButton } from '../../components/button/button';\nimport '../../utils/closestPolifill';\nimport { LogicFunction } from './filter.types';\nimport { FilterCaptions } from './filter.plugin';\nimport debounce from 'lodash/debounce';\n\n/**\n * @typedef FilterItem\n * @type {object}\n * @property {ColumnProp} prop - column id\n * @property {FilterType} type - filter type definition\n * @property {any} value - value for additional filtering, text value or some id\n */\nexport type FilterItem = {\n  prop?: RevoGrid.ColumnProp;\n  type?: FilterType;\n  value?: any;\n};\n\nexport type FilterData = {\n  id: number;\n  type: FilterType;\n  value?: any;\n  relation: 'and' | 'or';\n};\n\nexport type MultiFilterItem = {\n  [prop: string]: FilterData[];\n};\n\nexport type ShowData = {\n  x: number;\n  y: number;\n} & FilterItem;\n\nconst defaultType: FilterType = 'contains';\n\nconst FILTER_LIST_CLASS = 'multi-filter-list';\nconst FILTER_LIST_CLASS_ACTION = 'multi-filter-list-action';\n\n@Component({\n  tag: 'revogr-filter-panel',\n  styleUrl: 'filter.style.scss',\n})\nexport class FilterPanel {\n  private filterCaptionsInternal: FilterCaptions = {\n    title: 'Filter by condition',\n    save: 'Save',\n    reset: 'Reset',\n    cancel: 'Close',\n  };\n  @State() isFilterIdSet = false;\n  @State() filterId = 0;\n  @State() currentFilterId: number = -1;\n  @State() currentFilterType: FilterType = defaultType;\n  @State() changes: ShowData | undefined;\n  @Prop({ mutable: true, reflect: true }) uuid: string;\n  @Prop() filterItems: MultiFilterItem = {};\n  @Prop() filterTypes: Record<string, string[]> = {};\n  @Prop() filterNames: Record<string, string> = {};\n  @Prop() filterEntities: Record<string, LogicFunction> = {};\n  @Prop() filterCaptions: FilterCaptions | undefined;\n  @Prop() disableDynamicFiltering: boolean = false;\n  @Event() filterChange: EventEmitter<MultiFilterItem>;\n  @Listen('mousedown', { target: 'document' }) onMouseDown(e: MouseEvent): void {\n    if (this.changes && !e.defaultPrevented) {\n      const el = e.target as HTMLElement;\n      if (this.isOutside(el) && !isFilterBtn(el)) {\n        this.changes = undefined;\n      }\n    }\n  }\n  @Method() async show(newEntity?: ShowData) {\n    this.changes = newEntity;\n    if (this.changes) {\n      this.changes.type = this.changes.type || defaultType;\n    }\n  }\n\n  @Method() async getChanges() {\n    return this.changes;\n  }\n\n  componentWillRender() {\n    if (!this.isFilterIdSet) {\n      this.isFilterIdSet = true;\n      const filterItems = Object.keys(this.filterItems);\n      for (const prop of filterItems) {\n        // we set the proper filterId so there won't be any conflict when removing filters\n        this.filterId += this.filterItems[prop].length;\n      }\n    }\n  }\n\n  renderSelectOptions(type: FilterType, isDefaultTypeRemoved = false) {\n    const options: VNode[] = [];\n    const prop = this.changes?.prop;\n\n    // if (!isDefaultTypeRemoved) {\n    //   options.push(\n    //     <option selected={this.currentFilterType === defaultType} value={defaultType}>\n    //       {prop && this.filterItems[prop] && this.filterItems[prop].length > 0 ? 'Add more condition...' : this.filterNames[defaultType]}\n    //     </option>,\n    //   );\n    // }\n\n    for (let gIndex in this.filterTypes) {\n      options.push(\n        ...this.filterTypes[gIndex].map(k => (\n          <option value={k} selected={type === k}>\n            {this.filterNames[k]}\n          </option>\n        )),\n      );\n      // options.push(<option disabled></option>);\n    }\n\n    return options;\n  }\n\n  renderExtra(prop: RevoGrid.ColumnProp, index: number) {\n    const currentFilter = this.filterItems[prop];\n\n    if (!currentFilter) return '';\n\n    if (this.filterEntities[currentFilter[index].type].extra !== 'input') return '';\n\n    return (\n      <input\n        id={`filter-input-${currentFilter[index].id}`}\n        // placeholder=\"Enter value...\"\n        type=\"text\"\n        value={currentFilter[index].value}\n        onInput={this.onUserInput.bind(this, index, prop)}\n        onKeyDown={e => this.onKeyDown(e)}\n      />\n    );\n  }\n\n  getFilterItemsList() {\n    const prop = this.changes?.prop;\n    if (!(prop || prop === 0)) return '';\n\n    if (!this.filterItems[prop]) {\n      this.addNewFilter(defaultType);\n    }\n\n    let propFilters = this.filterItems[prop]\n\n    return (\n      <div key={this.filterId}>\n        {propFilters.map((d, index) => {\n          let andOrButton;\n\n          // hide toggle button if there is only one filter and the last one\n          if (index !== this.filterItems[prop].length - 1) {\n            andOrButton = (\n              <div onClick={() => this.toggleFilterAndOr(d.id)}>\n                <AndOrButton isAnd={d.relation === 'and'} />\n              </div>\n            );\n          }\n\n          return (\n            <div key={d.id} class={FILTER_LIST_CLASS}>\n              <div class={{ 'select-input': true }}>\n                <select class=\"select-css select-filter\" onChange={e => this.onFilterTypeChange(e, prop, index)}>\n                  {this.renderSelectOptions(this.filterItems[prop][index].type, false)}\n                </select>\n                {/* <div class={FILTER_LIST_CLASS_ACTION}>{andOrButton}</div> */}\n                <div onClick={() => this.onReset()}>\n                  <TrashButton />\n                </div>\n              </div>\n              <div>{this.renderExtra(prop, index)}</div>\n            </div>\n          );\n        })}\n\n        {/* {propFilters.length > 0 ? <div class=\"add-filter-divider\"></div> : ''} */}\n      </div>\n    );\n  }\n\n  render() {\n    if (!this.changes) {\n      return <Host style={{ display: 'none' }}></Host>;\n    }\n    const style = {\n      display: 'block',\n      left: `${this.changes.x}px`,\n      top: `${this.changes.y}px`,\n    };\n\n    const capts = Object.assign(this.filterCaptionsInternal, this.filterCaptions);\n\n    return (\n      <Host style={style}>\n        <label>{capts.title}</label>\n        <div class=\"filter-holder\">{this.getFilterItemsList()}</div>\n\n        {/* <div class=\"add-filter\">\n          <select id=\"add-filter\" class=\"select-css\" onChange={e => this.onAddNewFilter(e)}>\n            {this.renderSelectOptions(this.currentFilterType)}\n          </select>\n        </div> */}\n        <div class=\"filter-actions\">\n          {this.disableDynamicFiltering &&\n            <RevoButton class={{ red: true, save: true }} onClick={() => this.onSave()}>\n              {capts.save}\n            </RevoButton>\n          }\n          {/* <RevoButton class={{ red: true, reset: true }} onClick={() => this.onReset()}>\n            {capts.reset}\n          </RevoButton> */}\n          {/* <RevoButton class={{ light: true, cancel: true }} onClick={() => this.onCancel()}>\n            {capts.cancel}\n          </RevoButton> */}\n        </div>\n      </Host>\n    );\n  }\n\n  private onFilterTypeChange(e: Event, prop: RevoGrid.ColumnProp, index: number) {\n    const el = e.target as HTMLSelectElement;\n    const type = el.value as FilterType;\n\n    this.filterItems[prop][index].type = type;\n\n    // this re-renders the input to know if we need extra input\n    this.filterId++;\n\n    // adding setTimeout will wait for the next tick DOM update then focus on input\n    setTimeout(() => {\n      const input = document.getElementById('filter-input-' + this.filterItems[prop][index].id) as HTMLInputElement;\n      if (input) input.focus();\n    }, 0);\n\n    if (!this.disableDynamicFiltering) this.debouncedApplyFilter();\n  }\n\n  private debouncedApplyFilter = debounce(() => {\n    this.filterChange.emit(this.filterItems);\n  }, 400);\n\n  private onAddNewFilter(e: Event) {\n    let el\n    let type: FilterType;\n\n    el = e.target as HTMLSelectElement;\n    type = el.value as FilterType;\n\n    this.addNewFilter(type);\n  }\n\n  private addNewFilter(type: FilterType) {\n    this.currentFilterType = type;\n    this.addNewFilterToProp();\n\n    // reset value after adding new filter\n    const select = document.getElementById('add-filter') as HTMLSelectElement;\n    if (select) {\n      select.value = defaultType;\n      this.currentFilterType = defaultType;\n    }\n\n    if (!this.disableDynamicFiltering) this.debouncedApplyFilter();\n  }\n\n  private addNewFilterToProp() {\n    const prop = this.changes?.prop;\n    if (!(prop || prop === 0)) return;\n\n    if (!this.filterItems[prop]) {\n      this.filterItems[prop] = [];\n    }\n\n    if (this.currentFilterType === 'none') return;\n\n    this.filterId++;\n    this.currentFilterId = this.filterId;\n\n    this.filterItems[prop].push({\n      id: this.currentFilterId,\n      type: this.currentFilterType,\n      value: '',\n      relation: 'and',\n    });\n\n    // adding setTimeout will wait for the next tick DOM update then focus on input\n    setTimeout(() => {\n      const input = document.getElementById('filter-input-' + this.currentFilterId) as HTMLInputElement;\n      if (input) input.focus();\n    }, 0);\n  }\n\n  private onUserInput(index: number, prop: RevoGrid.ColumnProp, event: Event) {\n    // update the value of the filter item\n    this.filterItems[prop][index].value = (event.target as HTMLInputElement).value;\n\n    if (!this.disableDynamicFiltering) this.debouncedApplyFilter();\n  }\n\n  private onKeyDown(e: KeyboardEvent) {\n    if (e.key.toLowerCase() === 'enter') {\n      const select = document.getElementById('add-filter') as HTMLSelectElement;\n      if (select) {\n        select.value = defaultType;\n        this.currentFilterType = defaultType;\n        this.addNewFilterToProp();\n        select.focus();\n      }\n      return;\n    }\n    // keep event local, don't escalate farther to dom\n    e.stopPropagation();\n  }\n\n  private onSave() {\n    this.filterChange.emit(this.filterItems);\n  }\n\n  private onCancel() {\n    this.changes = undefined;\n  }\n\n  private onReset() {\n    this.assertChanges();\n\n    delete this.filterItems[this.changes.prop];\n\n    // this updates the DOM which is used by getFilterItemsList() key\n    this.filterId++;\n\n    this.filterChange.emit(this.filterItems);\n  }\n\n  private onRemoveFilter(id: number) {\n    this.assertChanges();\n\n    // this is for reactivity issues for getFilterItemsList()\n    this.filterId++;\n\n    const prop = this.changes.prop;\n\n    const items = this.filterItems[prop];\n    if (!items) return;\n\n    const index = items.findIndex(d => d.id === id);\n    if (index === -1) return;\n    items.splice(index, 1);\n\n    // let's remove the prop if no more filters so the filter icon will be removed\n    if (items.length === 0) delete this.filterItems[prop];\n\n    if (!this.disableDynamicFiltering) this.debouncedApplyFilter();\n  }\n\n  private toggleFilterAndOr(id: number) {\n    this.assertChanges();\n\n    // this is for reactivity issues for getFilterItemsList()\n    this.filterId++;\n\n    const prop = this.changes.prop;\n\n    const items = this.filterItems[prop];\n    if (!items) return;\n\n    const index = items.findIndex(d => d.id === id);\n    if (index === -1) return;\n\n    items[index].relation = items[index].relation === 'and' ? 'or' : 'and';\n    if (!this.disableDynamicFiltering) this.debouncedApplyFilter();\n  }\n\n  private assertChanges() {\n    if (!this.changes) {\n      throw new Error('Changes required per edit');\n    }\n  }\n\n  private isOutside(e: HTMLElement | null) {\n    const select = document.getElementById('add-filter') as HTMLSelectElement;\n    if (select) select.value = defaultType;\n\n    this.currentFilterType = defaultType;\n    this.changes.type = defaultType;\n    this.currentFilterId = -1;\n    if (e.classList.contains(`[uuid=\"${this.uuid}\"]`)) {\n      return false;\n    }\n    return !e?.closest(`[uuid=\"${this.uuid}\"]`);\n  }\n}\n"],"mappings":"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"}